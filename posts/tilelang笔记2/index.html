<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="å”æ™¨å¤çš„ä¸ªäººåšå®¢"><meta name="author" content="å”æ™¨å¤ (Chenxia Tang)"><link rel="icon" type="image/jpeg" href="/fav.jpg"><link rel="canonical" href="https://blog.tomorrowdawn.cc/posts/tilelang%E7%AC%94%E8%AE%B02"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><!-- Open Graph --><meta property="og:title" content="Tilelangç¬”è®°2 | å”æ™¨å¤çš„åšå®¢"><meta property="og:description" content="å”æ™¨å¤çš„ä¸ªäººåšå®¢"><meta property="og:image" content="https://blog.tomorrowdawn.cc/avatar.jpg"><meta property="og:url" content="https://blog.tomorrowdawn.cc/posts/tilelang%E7%AC%94%E8%AE%B02"><meta property="og:type" content="article"><meta property="og:site_name" content="å”æ™¨å¤çš„åšå®¢"><!-- Twitter Card --><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tilelangç¬”è®°2 | å”æ™¨å¤çš„åšå®¢"><meta name="twitter:description" content="å”æ™¨å¤çš„ä¸ªäººåšå®¢"><meta name="twitter:image" content="https://blog.tomorrowdawn.cc/avatar.jpg"><!-- JSON-LD Structured Data --><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","name":"å”æ™¨å¤çš„åšå®¢","url":"https://blog.tomorrowdawn.cc","author":{"@id":"https://blog.tomorrowdawn.cc/#person"}},{"@type":"Person","@id":"https://blog.tomorrowdawn.cc/#person","name":"å”æ™¨å¤","alternateName":["Chenxia Tang","TomorrowDawn"],"url":"https://blog.tomorrowdawn.cc","sameAs":["https://github.com/TomorrowDAW","https://www.zhihu.com/people/tang-chen-xia-48"]}]}</script><title>Tilelangç¬”è®°2 | å”æ™¨å¤çš„åšå®¢</title> <script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tilelangç¬”è®°2","datePublished":"2026-01-04","author":{"@type":"Person","name":"å”æ™¨å¤","alternateName":["Chenxia Tang","TomorrowDawn"],"url":"https://blog.tomorrowdawn.cc"},"image":"https://blog.tomorrowdawn.cc/avatar.jpg","url":"https://blog.tomorrowdawn.cc/posts/tilelangç¬”è®°2"}</script> <style>:root{--color-bg: #fafafa;--color-text: #333;--color-text-muted: #666;--color-border: #e0e0e0;--color-accent: #333;--color-link: #2563eb;--color-link-hover: #1d4ed8;--font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;--font-mono: "SF Mono", Monaco, "Cascadia Code", monospace;--max-width: 1200px;--sidebar-width: 280px}html{font-family:var(--font-sans);font-size:16px;line-height:1.6;color:var(--color-text);background:var(--color-bg)}body{min-height:100vh}a{color:var(--color-link);text-decoration:none;transition:color .15s ease}a:hover{color:var(--color-link-hover);text-decoration:underline}code{font-family:var(--font-mono);font-size:.9em;background:#f0f0f0;padding:.1em .3em;border-radius:3px}pre{background:#f5f5f5;padding:1rem;border-radius:4px;overflow-x:auto}pre code{background:none;padding:0}blockquote{margin:1rem 0;padding:0 1rem 0 1.5rem;position:relative;color:var(--color-text-muted)}blockquote:before{content:"";position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--color-border)}.nav[data-astro-cid-dmqpwcec]{border-bottom:1px solid rgba(15,23,42,.1);background:var(--color-bg)}.nav-content[data-astro-cid-dmqpwcec]{max-width:var(--max-width);margin:0 auto;padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between}.nav-links[data-astro-cid-dmqpwcec]{display:flex;gap:1.5rem}.nav-link[data-astro-cid-dmqpwcec]{color:#555;font-size:.95rem;font-weight:500;transition:color .2s ease}.nav-link[data-astro-cid-dmqpwcec]:hover{color:#111;text-decoration:none}.nav-title[data-astro-cid-dmqpwcec]{font-size:1.35rem;font-weight:700;letter-spacing:.04em;color:#111;font-family:Space Grotesk,Inter,system-ui,sans-serif}.nav-title[data-astro-cid-dmqpwcec]:hover{text-decoration:none}
.container[data-astro-cid-gysqo7gh]{max-width:800px;margin:0 auto;padding:2rem}.post-header[data-astro-cid-gysqo7gh]{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--color-border)}.post-header[data-astro-cid-gysqo7gh] h1[data-astro-cid-gysqo7gh]{font-size:2rem;line-height:1.3;margin-bottom:1rem}.post-meta[data-astro-cid-gysqo7gh]{display:flex;align-items:center;gap:1rem;color:var(--color-text-muted);font-size:.9rem}.tags[data-astro-cid-gysqo7gh]{display:flex;gap:.5rem}.tag[data-astro-cid-gysqo7gh]{padding:.2rem .6rem;background:#f0f0f0;border-radius:3px;font-size:.8rem}.post-content[data-astro-cid-gysqo7gh]{line-height:1.8}.post-content[data-astro-cid-gysqo7gh] h2,.post-excerpt[data-astro-cid-gysqo7gh] h2{font-size:1.5rem;margin:2rem 0 1rem}.post-content[data-astro-cid-gysqo7gh] h3,.post-excerpt[data-astro-cid-gysqo7gh] h3{font-size:1.25rem;margin:1.5rem 0 .75rem}.post-content[data-astro-cid-gysqo7gh] p,.post-excerpt[data-astro-cid-gysqo7gh] p{margin-bottom:1rem}.post-content[data-astro-cid-gysqo7gh] ul,.post-content[data-astro-cid-gysqo7gh] ol,.post-excerpt[data-astro-cid-gysqo7gh] ul,.post-excerpt[data-astro-cid-gysqo7gh] ol{margin-bottom:1rem;padding-left:1.5rem}.post-content[data-astro-cid-gysqo7gh] ol,.post-excerpt[data-astro-cid-gysqo7gh] ol{list-style-type:decimal}.post-content[data-astro-cid-gysqo7gh] ul,.post-excerpt[data-astro-cid-gysqo7gh] ul{list-style-type:disc}.post-content[data-astro-cid-gysqo7gh] li,.post-excerpt[data-astro-cid-gysqo7gh] li{margin-bottom:.5rem}.post-content[data-astro-cid-gysqo7gh] blockquote,.post-excerpt[data-astro-cid-gysqo7gh] blockquote{margin:1rem 0;padding:0 1rem 0 1.5rem;position:relative;color:var(--color-text-muted)}.post-content[data-astro-cid-gysqo7gh] blockquote:before,.post-excerpt[data-astro-cid-gysqo7gh] blockquote:before{content:"";position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--color-border)}.post-content[data-astro-cid-gysqo7gh] img,.post-excerpt[data-astro-cid-gysqo7gh] img{max-width:100%;height:auto;border-radius:4px}
</style></head> <body>   <nav class="nav" data-astro-cid-dmqpwcec> <div class="nav-content" data-astro-cid-dmqpwcec> <a href="/" class="nav-title" data-astro-cid-dmqpwcec>Tomorrowdawn's Blog</a> <div class="nav-links" data-astro-cid-dmqpwcec> <a href="/about" class="nav-link" data-astro-cid-dmqpwcec>About</a> </div> </div> </nav>  <main class="container" data-astro-cid-gysqo7gh> <article class="post" data-astro-cid-gysqo7gh> <header class="post-header" data-astro-cid-gysqo7gh> <h1 data-astro-cid-gysqo7gh>Tilelangç¬”è®°2</h1> <div class="post-meta" data-astro-cid-gysqo7gh> <time datetime="2026-01-04" data-astro-cid-gysqo7gh>2026-01-04</time> <div class="tags" data-astro-cid-gysqo7gh> <span class="tag" data-astro-cid-gysqo7gh>math</span><span class="tag" data-astro-cid-gysqo7gh>code</span> </div> </div> </header> <div class="post-content" data-astro-cid-gysqo7gh> <p>ä¸Šä¸€ç¯‡</p>
<p><a href="https://zhuanlan.zhihu.com/p/1989012911822233911">TileLangç¬”è®°</a></p>
<p>æœ¬ç¯‡åŒæ ·ä¿ç•™äº†æˆ‘çš„æ‰€æœ‰ç¢ç¢å¿µã€‚</p>
<blockquote>
<p>å› æ­¤è¿™ä¸æ˜¯ä¸€ç¯‡é€‚åˆæ‰€æœ‰äººé˜…è¯»çš„æ–‡ç« ã€‚</p>
</blockquote>
<p>è¿™å›æˆ‘ä» Gemini é‚£é‡Œé¢†åˆ°äº†ä¸€ä¸ªä»»åŠ¡ï¼š</p>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="1502" height="1346" src="/_astro/v2-db5609a95694ff63faaf01ce973f215e_r.D9iSxehu_YibU4.webp" ></p>
<blockquote>
<p>åæ§½ï¼šPylanceä¼šå¯¹</p>
<p>T.buffer</p>
<p>è¿™ä¸ªå†™æ³•æŠ¥é”™ï¼ˆåœ¨ç±»å‹æ³¨é‡Šé‡Œè°ƒç”¨å‡½æ•°ï¼‰ã€‚æˆ‘å¾ˆå¥½å¥‡tilelangçš„å¼€å‘è€…ç”¨æˆ·å…¨éƒ¨éƒ½èƒ½å¿å—è¿™ç§çº¢è‰²æ³¢æµªçº¿å†™ä¸‹å»å—â€¦â€¦</p>
</blockquote>
<p>æ‹¿åˆ°è¿™ä¸ªéª¨æ¶ä¹‹åï¼Œæˆ‘æ„è¯†åˆ°ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæˆ‘è¯¥å¦‚ä½•å£°æ˜ä¸€ä¸ªtilelangå˜é‡ï¼Ÿ</p>
<p>æ—‹å³ï¼Œæˆ‘æ„è¯†åˆ°æˆ‘ä¸çŸ¥é“è¿™æ®µä»£ç æœ¬èº«æƒ³è¡¨è¾¾ä½•ç§â€œæ„å›¾â€ã€‚æˆ‘å¯¹tilelangçš„ç¼–ç¨‹æ¨¡å‹ç¼ºä¹è®¤çŸ¥ã€‚</p>
<p>ç»è¿‡æˆ‘å¯¹geminiçš„ä¸€ç³»åˆ—è¿½é—®ä¹‹åï¼Œå¾—åˆ°ï¼š</p>
<ol>
<li>è¢« T.Kernel åŒ…è£¹çš„ä»£ç æ˜¯ä¸€ä¸ªâ€œå—â€çš„è¡Œä¸ºé›†åˆã€‚ Tilelang åœ¨å—çº§åˆ«ç¼–ç¨‹ã€‚</li>
<li>ä½ å¯ä»¥å¾ˆæ­£å¸¸åœ°ä½¿ç”¨ <code>x= by * 2</code> æ¥å£°æ˜ç®€å•çš„ä¸´æ—¶å˜é‡ï¼ˆint, floatä¹‹ç±»çš„ï¼‰ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ <code>alloc_fragment</code> åˆ†é…å¯„å­˜å™¨ã€‚ä¾‹å¦‚ <code>acc = alloc_fragment([128, 128])</code> è¯·æ³¨æ„ï¼Œæ­£å› ä¸ºTilelangåœ¨å—çº§åˆ«ç¼–ç¨‹ï¼Œæ‰€ä»¥ <code>acc</code> æ˜¯ä¸€ä¸ª â€œå¼¥æ•£â€ åœ¨æ•´ä¸ªå—é‡Œé¢çš„å¯„å­˜å™¨ç»„ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸é€æ˜å¸ƒå±€Opaque Layoutï¼Œä¸è¿ç»­ï¼Œä¸èƒ½ç®€å•åœ°ä½¿ç”¨i,jè¿›è¡Œéšæœºè®¿é—®ã€‚ åœ¨ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚T.parallelæ„å»ºçš„çº¿ç¨‹ç¯å¢ƒå†…ï¼‰ï¼Œå¯ä»¥é€šè¿‡i,jè®¿é—®ã€‚ï¼ˆè¯­æ³•ä¸Šä½ æ€»æ˜¯å¯ä»¥è®¿é—®ï¼Œä½†åªæœ‰è¿™ç§åœºæ™¯ä¸‹æ‰ä¸ä¼šæŠ¥é”™ï¼‰ ä¹Ÿå› æ­¤ï¼Œ <code>fragment</code> ç±»å‹çš„å˜é‡åªèƒ½è¿›è¡Œæ‰¹æ¬¡æ“ä½œï¼ˆä¾‹å¦‚æ‰¹æ¬¡ä¼ è¾“ï¼Œæ‰¹æ¬¡è®¡ç®—ï¼‰ã€‚ ä½¿ç”¨ <code>copy</code> ä¼ è¾“ï¼Œ <code>clear</code> ç½®é›¶ã€‚ å®ƒæœ€å¸¸è§çš„ç”¨æ³•æ˜¯ä½œä¸º <code>T.gemm</code> çš„è¾“å‡ºå‚æ•°</li>
<li>T.Bufferç­‰ä»·äº T.Tensor . è¯´æ˜è¿™æ˜¯ä¸€ä¸ªå­˜åœ¨Global Memoryé‡Œé¢çš„tensor</li>
</ol>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦è¯´æ˜ã€‚Tilelangæ˜¯ä¸€é—¨æè¿°çº¿ç¨‹å—çš„DSL, å› æ­¤æ“ä½œæœ€å¥½ä½¿ç”¨æ•´å—ï¼ˆä¾‹å¦‚åˆ‡ç‰‡ï¼‰ï¼Œtilelangä¼šè‡ªå·±å¤„ç†å¥½åº•å±‚çš„å¹¶è¡Œé—®é¢˜ã€‚å¦‚æœä½ å±•å¼€åˆ°çº¿ç¨‹çº§åˆ«ï¼ˆä¾‹å¦‚Parallelï¼‰ï¼Œé‚£ä¹ˆä½ å°±åªèƒ½æ“ä½œä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>è¯´èµ·æ¥æœ‰ç‚¹éº»çƒ¦ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘å£°æ˜äº† <code>A: T.Buffer((1024, 1024), "float16")</code></p>
<p>æˆ‘éœ€è¦å°†Aä¸­çš„ä¸€å°å—æ¬åˆ°ä¸€ä¸ª32çº¿ç¨‹ç»„æˆçš„å—å†…ï¼ˆæš‚æ—¶è®©æˆ‘ç”¨fragmentå†…å­˜è¯´æ˜ï¼‰ï¼š</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>with T.Kernel(32, 32, threads=32) as bx, by:</span></span>
<span class="line"><span>  A_frag = T.alloc_fragment((128, 128), "float16")</span></span>
<span class="line"><span>  A_tile = A[0:128, 0:128]</span></span>
<span class="line"><span>  T.copy(A_tile, A_frag) </span></span></code></pre>
<p>tilelangä¼šè‡ªå·±åœ¨åº•ä¸‹å¤„ç†å¥½â€œä½¿ç”¨32ä¸ªçº¿ç¨‹æ¬è¿128*128æ•°æ®å—â€è¿™æ ·ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>ä½†å¦‚æœä½ ä½¿ç”¨Parallel,ç”±äºParallelç®¡è¾–çš„å—æ˜¯çº¿ç¨‹ï¼ˆ <strong>æ³¨æ„ï¼Œæ˜¯é€»è¾‘çº¿ç¨‹ï¼Œä¸æ˜¯ç‰©ç†çº¿ç¨‹</strong> ï¼‰ï¼Œæ‰€ä»¥ä½ åªèƒ½è‡ªå·±æ‰‹åŠ¨å¤åˆ¶ï¼š</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>for i, j in T.Parallel(128, 128):</span></span>
<span class="line"><span>    A_frag[i, j] = A[i, j] </span></span></code></pre>
<p>åœ¨æ˜ç™½Fragmentä¹‹åï¼Œæˆ‘å°±éœ€è¦äº†è§£ä¸€ä¸‹Sharedäº†ï¼š</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span># å£°æ˜ä¸€ä¸ª 128x32 çš„ float16 å…±äº«å†…å­˜å—</span></span>
<span class="line"><span>A_shared = T.alloc_shared((128, 32), "float16")</span></span></code></pre>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="1494" height="724" src="/_astro/v2-6765ce59ea58e42a529e247b1a733036_r.CeU8c6gF_Z25u4H.webp" ></p>
<p>Geminiå†™çš„è¿™ä¸ªæ€»ç»“çœŸæŒºä¸é”™ï¼š</p>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="1070" height="350" src="/_astro/v2-c7d7f07ea98711cfa4030c0eb5d92bdf_r.BJGZ58sX_1Moy5m.webp" ></p>
<p>ä¸­åœºä¼‘æ¯æ—¶é—´ï¼š</p>
<p>æˆªæ­¢ç°åœ¨ï¼Œæˆ‘å­¦ä¹ äº†ï¼š</p>
<p>å£°æ˜å…¥å£Tensor:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>A: T.Buffer(shape, dtype)</span></span></code></pre>
<p>ä¸¤ç§å†…å­˜å£°æ˜æ–¹å¼ï¼š</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>T.alloc_fragment(shape, dtype) ##å¼¥æ•£åœ¨å—å†…ï¼Œåªèƒ½ä»¥å—çŠ¶è®¿é—®ï¼Œæ•°é‡å—é™</span></span>
<span class="line"><span>T.alloc_shared(shape, dtype) ##è¢«å—å…±äº«ï¼Œå°±æ˜¯cudaçš„shared mem. æ•°é‡å¯ä»¥å¤šä¸€ç‚¹ï¼ˆä½†ä¹Ÿä¸æ˜¯æ— é™çš„ï¼‰</span></span></code></pre>
<p>ç§»åŠ¨æ–¹å¼ï¼š</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>T.copy(src, dst) # ä»srcå¼€å§‹çš„å­—èŠ‚ï¼Œè¾“å…¥åˆ°dst.</span></span>
<span class="line"><span>#é€šå¸¸ï¼Œsrcå’Œdstä¸æ˜¯åŒä¸€ç§å†…å­˜ã€‚æ‰€ä»¥T.copyå°±æ˜¯é»˜è®¤çš„è·¨å†…å­˜å±‚æ¬¡ä¼ è¾“æ•°æ®çš„æ“ä½œ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å¦‚æœsrc regionï¼ˆå¤§è‡´å¯ä»¥çœ‹æˆshape) &#x3C; dst regionï¼Œé‚£ä¹ˆå¹¿æ’­srcçš„regionï¼Œä½¿å…¶ç­‰åŒäºdstçš„regionå¤§å°ï¼ˆä¾‹å¦‚ä¸€ä¸ªå…ƒç´ æ‰©å¼ æˆN*Nä¸ªï¼‰ã€‚</span></span>
<span class="line"><span>#ç”±äºå¼€å¤´æŒ‡é’ˆè¿˜æ˜¯src, æ‰€ä»¥ç­‰ä»·äºä»srcå¼€å§‹å·¦ä¸Šè§’çš„å­—èŠ‚å¤åˆ¶è¿‡å»ã€‚</span></span>
<span class="line"><span>#å¦‚æœdst region &#x3C; src regionï¼ŒåŒæ ·ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªå±é™©çš„æ“ä½œï¼Œå› ä¸ºdstä¸ä¸€å®šå‡†å¤‡å¥½äº†é‚£ä¹ˆé•¿çš„åŒºåŸŸã€‚</span></span>
<span class="line"><span>#æ— è®ºå¦‚ä½•ï¼Œå»ºè®®srcå’Œdstéƒ½æ˜¯ä¸€æ ·çš„å½¢çŠ¶ä»¥é¿å…æ„å¤–ã€‚</span></span></code></pre>
<p>å†™ä¸€ä¸ªç®€å•çš„vector add:</p>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="958" height="1016" src="/_astro/v2-3c72a46b844a1538fc3b391fab2e6d76_r.CaKCD3GB_RALUO.webp" ></p>
<p><a href="https://link.zhihu.com/?target=https%3A//tilelang.com/deeplearning_operators/elementwise.html">https://tilelang.com/deeplearning_operators/elementwise.html</a> ä¸­æœ‰ä¸€ä¸ªæ›´åŠ é«˜åº¦ä¼˜åŒ–çš„vaddæ ¸ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯æ§åˆ¶æµã€‚Tilelangä¸­æœ€å¸¸ç”¨çš„æœ‰ä¸‰ç§æ§åˆ¶æµï¼š</p>
<ol>
<li><code>T.Parallel</code> ã€‚å¦‚å‰æ‰€è¿°ï¼Œè¿™ç”¨äºåˆ›å»ºå®Œå…¨å¹¶è¡Œçš„é€»è¾‘ä»»åŠ¡ã€‚ä»»åŠ¡ä¹‹é—´æ¯«æ— å…³è”</li>
<li><code>T.Serial</code> ã€‚è¿™ä¸ªå’ŒPythonçš„rangeä¸€æ ·ã€‚é¡ºåºæ‰§è¡Œï¼Œæä¾›è¿­ä»£æ­¥æ•°çš„ä¸‹æ ‡ã€‚</li>
<li><code>T.Pipelined</code> ã€‚è¿™ä¸ªè‡ªåŠ¨åˆ›å»ºå¤šçº§æµæ°´çº¿ï¼ˆè¢«num_stagesï¼‰æ§åˆ¶ã€‚Tilelangä¼šè¯†åˆ«ä½ æ¥ä¸‹æ¥å—ä¸­çš„copyå’Œè®¡ç®—ï¼Œç„¶åè‡ªåŠ¨æ„å»ºç”Ÿäº§è€…/æ¶ˆè´¹è€…æµæ°´çº¿ï¼Œé‡å æ‹·è´å’Œè®¡ç®—ã€‚</li>
</ol>
<p>tilelangä¸ºæˆ‘ä»¬æä¾›äº†å“ªäº›ç®—å­å‘¢ï¼Ÿ</p>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="1584" height="1002" src="/_astro/v2-d9a3b7f14440331aa06e842b01e49835_r.D8fLdQqo_xT6U9.webp" ></p>
<p><a href="https://link.zhihu.com/?target=https%3A//tilelang.com/programming_guides/instructions.html">https://tilelang.com/programming_guides/instructions.html</a> è¯¥é¡µé¢æœ‰æ›´å…¨é¢çš„ä»‹ç»ï¼ŒgoodğŸ‘</p>
<blockquote>
<p>è¿™é‡Œé¢æœ‰å¾ˆå¤šç‰¹å®šäºæ¶æ„çš„åŸè¯­ã€‚åœ¨ä¹‹åçš„æ–‡ç« ä¸­å°½é‡ä»‹ç»ï¼ˆå¦‚æœæˆ‘æœ‰æœºä¼šå»Hå¡ä¸Šä¼˜åŒ–çš„è¯â€¦â€¦ï¼‰</p>
</blockquote>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ <code>T.gemm(A, B, C)</code> ï¼Œå°±è¶³å¤Ÿå¼€å§‹å†™Gemmç®—å­äº†ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œè¿™é‡Œè¦æ±‚ <code>C</code> æ˜¯ä¸€ä¸ªfragmentï¼ˆå¯„å­˜å™¨ï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯ç´¯åŠ å¯„å­˜å™¨åœ°å€ã€‚</p>
<p>æœ€ç»ˆçš„Gemmç®—å­ï¼š</p>
<p>åœ¨cudaé‡Œé¢Gemmå±äºå¿…åƒæ¦œæ¦œä¸€ï¼Œ <a href="https://zhuanlan.zhihu.com/p/1900941224883516265">ã€cudaå…¥é—¨ã€‘å…±äº«å†…å­˜ä¼˜åŒ–çŸ©é˜µä¹˜</a> ä¸­ä¹Ÿä»‹ç»äº†cudaä¸­é€šå¸¸å¦‚ä½•è®¡ç®—ã€‚è¿™é‡Œå†ç®€å•å›é¡¾ä¸€ä¸‹ï¼š</p>
<p>å¯¹äº C = A*Bè¿ç®—è€Œè¨€ï¼Œå¯ä»¥ç®€è®°ä¸º</p>
<p><code>[i, j ]= [i, :] * [:, j]</code> ä¸­é—´ç»´åº¦å°±æ˜¯Kç»´åº¦ã€‚</p>
<p>æˆ‘ä»¬å°† K ç»´åº¦åˆ†å—ï¼Œå°±æœ‰</p>
<p><code>[i,j]=[i, 0:k] * [0:k, j] + [i, k:2k]*[k:2k, j]+...</code></p>
<p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä»¥ä¸‹ä¾‹å­ï¼š</p>
<ol>
<li>å¯¹äº <code>[i,j]</code> , éœ€è¦ <code>[i, 0:k] * [0:k, j]</code></li>
<li>å¯¹äº <code>[i+1, j]</code> , éœ€è¦ <code>[i+1, 0:k] * [0:k, j] </code></li>
<li>å¯¹äº <code>[i, j + 1]</code> , éœ€è¦ <code>[i, 0:k] * [0:k, j+1]</code></li>
<li>å¯¹äº <code>[i+1, j +1]</code> , éœ€è¦ <code>[i+1, 0:k] * [0:k, j+1]</code></li>
</ol>
<p>ä½ ä¼šå‘ç°ï¼Œåœ¨æ¯ä¸€æ­¥ï¼ŒKç»´åº¦ä¸Šçš„éœ€æ±‚å…¶å®æ˜¯ä¸€æ ·çš„ã€‚è€Œä¸»è¦æ˜¯Må’ŒNç»´åº¦ä¸Šæœ‰è½»å¾®çš„å˜åŒ–ï¼Œå¯¼è‡´è¿™å››ä¸ªå…ƒç´ ä¹‹é—´æœ‰äº›å—é‡å ï¼Œæœ‰äº›ä¸é‡å ã€‚ä¾‹å¦‚[i, j]å’Œ[i+1, j]éœ€è¦åŒæ ·çš„Bå—ï¼Œä¸åŒçš„Aå—ï¼›[i, j]å’Œ [i, j+1]éœ€è¦åŒæ ·çš„Aå—ï¼Œä¸åŒçš„Bå—ã€‚åªæœ‰å°†è¿™å››ä¸ªå…ƒç´ çš„æ‰€éœ€å…¨éƒ¨â€œæ±‚ä¸ªå¹¶é›†â€ï¼Œæˆ‘ä»¬æ‰èƒ½æ°å¥½æ»¡è¶³æ‰€æœ‰å…ƒç´ çš„éœ€æ±‚ã€‚</p>
<blockquote>
<p>æˆ‘å–œæ¬¢åœ¨è¿™é‡Œåšä¸€ä¸ªæƒ³è±¡ï¼šæƒ³è±¡[i, j]åœ¨â€œå¤§é¹å±•ç¿…â€ï¼Œè¦†ç›–ä¸€ä¸ªçŸ©é˜µï¼Œä½¿å¾—è‡ªå·±æ‰€ä½¿ç”¨çš„å—å’Œå…¶ä»–å…ƒç´ èƒ½é‡å ã€‚</p>
</blockquote>
<p>å½¢å¼åŒ–åœ°è®²ï¼Œå¯¹äºå— <code>C[i:i+k, j:j+k]</code> è€Œè¨€ï¼Œåœ¨ç¬¬ <code>s</code> æ­¥ï¼Œä»–ä»¬éœ€è¦ï¼š</p>
<ol>
<li><code>A[i:i+k, s*k:(s+1)k]</code></li>
<li><code>B[s*k:(s+1)k, j:j+k]</code></li>
<li>æ²¡æœ‰å…¶ä»–å†…å­˜éœ€æ±‚ï¼Œæ‰€ä»¥ä»–ä»¬å¯ä»¥å…±äº«ä¸Šè¿°ä¸¤ä¸ªå°å—ï¼ˆä¸å¦¨å«a_tileå’Œb_tileï¼‰ã€‚</li>
</ol>
<p>åœ¨æ¯ä¸€æ­¥ï¼Œæˆ‘ä»¬åªéœ€è®¡ç®—ä¸€ä¸ªå°è§„æ¨¡çš„gemm: <code>acc += a_tile * b_tile</code> å³å¯ã€‚Tilelangå°±æ˜¯æä¾›äº†ä¸€ä¸ªå°è§„æ¨¡çš„gemmç®—å­ <code>T.gemm(A,B, C_frag)</code> ã€‚å®ƒç­‰äº <code>C_frag += A * B</code></p>
<p>äº†è§£äº†è¿™äº›ä¹‹åï¼ŒTilelangç¼–å†™gemmå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š</p>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="1478" height="1146" src="/_astro/v2-6d65ae9d63bfb2c38a856edcafb9118b_r.BB3Y4kum_Z1tNhbB.webp" ></p>
<p>çœ‹ä¸Šå»ä¸é”™ï¼</p>
<p>ä½†æ˜¯ä¸çŸ¥é“æœ‰æ²¡æœ‰ç»†å¿ƒçš„è¯»è€…æ³¨æ„åˆ°ï¼Œå…¶å®è¿™æ®µä»£ç é‡Œé¢æœ‰é—®é¢˜ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼šåˆå§‹åŒ–accæ—¶å¿˜è®°æ¸…é›¶äº†ï¼</p>
<p>ä»¥ä¸‹æ‰æ˜¯æ­£ç¡®ç­”æ¡ˆï¼š</p>
<p><img alt="image" loading="lazy" decoding="async" fetchpriority="auto" width="1482" height="1040" src="/_astro/v2-4cecfa2b8dc770e97883422c45dc3a90_r.BnNK19_M_2agIIc.webp" ></p>
<blockquote>
<p>ä½ å·²ç»å­¦ä¼štilelangäº†ï¼Œå¿«å»é‡å†™DeepGemmå§</p>
</blockquote> </div> </article> </main>  </body></html> 